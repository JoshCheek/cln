#!/usr/bin/env ruby

$LOAD_PATH.unshift "/Users/joshcheek/code/i_like_mustaches/lib"

require 'i_like_mustaches'

cln = ILikeMustaches.new do |cln|
  cln.description = 'Command Line Notes'



  # life
  cln.quick_note 'drivers license info', 'http://www.cyberdriveillinois.com/publications/pdf_publications/dsd_x173.pdf', 'licenses', 'illinois', 'ids', 'identification', 'cards'

  # readline
  cln.quick_note "beginning of history",            "M-<",   "readline", "keybindings"
  cln.quick_note "end of history",                  "M->",   "readline", "keybindings"
  cln.quick_note "forward search history",          "C-s",   "readline", "keybindings"
  cln.quick_note "yank last arg (iteratively)",     "M-.",   "readline", "keybindings"
  cln.quick_note "yank last arg (iteratively)",     "M-.",   "readline", "keybindings"
  cln.quick_note "delete right",                    "C-d",   "readline", "keybindings"
  cln.quick_note "transpose words",                 "M-t",   "readline", "keybindings"
  cln.quick_note "upcase word",                     "M-u",   "readline", "keybindings", "capitalize", "uppercase", "capitalization"
  cln.quick_note "downcase word",                   "M-l",   "readline", "keybindings", "lowercase", "capitalization"
  cln.quick_note "delete next word",                "M-d",   "readline", "keybindings"
  cln.quick_note "show possible completions",       "M-?",   "readline", "keybindings"
  cln.quick_note "insert all possible completions", "M-*",   "readline", "keybindings", "expand", "expansions"
  cln.quick_note "start keyboard macro",            "C-x (", "readline", "keybindings", "begin"
  cln.quick_note "end keyboard macro",              "C-x )", "readline", "keybindings", "stop"
  cln.quick_note "execute keyboard macro",          "C-x e", "readline", "keybindings", "run"
  cln.quick_note "incremental undo",                "C-_",   "readline", "keybindings"
  cln.quick_note "tilde expand",                    "M-&",   "readline", "keybindings", "expansion"

  # haskell
  cln.quick_note "Add a package to dependencies", "put it build-depens in name.cabal, then\n$ cabal-dev install", "haskell"
  cln.quick_note "Build the package",             "$ cabal-dev install", "haskell"

  # git
  cln.quick_note 'figure out which branches contain a commit',    'git branch -a --contains SHA'
  cln.quick_note '5 lines of context on a diff',                  'git diff -U5'
  cln.quick_note 'alternative diff algorithm',                    'cd martini_at_zoo; git show 0599a52c3ced58480e3b18ec5c366f0b83a69e2c --patience'
  cln.quick_note 'Show only filenames in diff',                   'git diff --name-only'
  cln.quick_note 'Only look in cwd subtree',                      'git diff --relative'
  cln.quick_note 'list unmerged files',                           'git ls-files -u'
  cln.quick_note 'delete stale remote tracking branches',         'git remote prune origin'
  cln.quick_note 'contentless commit (e.g. to force sha update)', 'git commit -m "whatever" --allow-empty'
  cln.quick_note 'show last commit that matches the string',      'git show :/query'
  cln.quick_note 'show branches merged into current branch',      'git branch --merged'
  cln.quick_note 'show branches not merged into current branch',  'git branch --no-merged'
  cln.quick_note "copy other branch's version of a file into wd", 'git checkout BRANCH -- path/to/file'
  cln.quick_note "show commits in A that aren't in B",            'git log A ^B'
  cln.quick_note "blame the oiginal commit, not the move commit", <<-GIT
    git blame -M   # moved within file
              -C   # moved within commit
              -CC  # where line was created
              -CCC # look at all commits
  GIT
  cln.quick_note "count how many commits each person made",       'git shortlog -sn'

  # github
  cln.quick_note 'github will suppress trailing whitespace',        '?w=1 (add to the end of any diff url)'
  cln.quick_note 'octocat index',                                   'http://octodex.github.com/', 'github'
  cln.quick_note 'github: get a file finder',                       't'
  cln.quick_note 'github: swap the branch name for the sha',        'y'
  cln.quick_note 'github: find all the commands on a given page',   '?'
  cln.quick_note 'github: scope commit history to specific author', '?author=josh_cheek'
  cln.quick_note 'github: emoji cheat sheet',                       'http://www.emoji-cheat-sheet.com/'
  cln.quick_note 'github: compare view',                            <<-EOS
    github.com/user/repo/compare/{range}
      where {range} is a branch name, sha, 1.day.ago, yesterday, 2012-12-30
  EOS

  # ruby
    # globals
    cln.quick_note 'ARGF', '$<', 'globals', 'variables', 'ruby'
    # capybara
    cln.quick_note 'The DSL uses this session:', 'Capybara.session', 'capybara', 'testing', 'ruby'
    cln.quick_note 'Find the current path', 'session.current_path', 'capybara', 'testing', 'ruby', 'url'

  # homebrew
  cln.quick_note "homebrew binaries are in", "/usr/local/bin"

  # postgresql
  cln.quick_note 'postgresql: quit',                            '\q',       'pg', 'meta', 'exit', 'C-c'
  cln.quick_note 'postgresql: display users',                   '\du',      'pg', 'meta'
  cln.quick_note 'postgresql: show permissions',                '\z',       'pg', 'meta'
  cln.quick_note 'postgresql: show table names',                '\z',       'pg', 'meta'
  cln.quick_note 'postgresql: show table names in a namespace', '\z rbf.*', 'pg', 'meta'
  cln.quick_note 'postgresql: find the list of pids connected', 'SELECT procpid, application_name from pg_stat_activity;', 'pg', 'meta'

  # vim
  cln.quick_note 'Vim ctags: find reference to class',               ':tag ClassName'
  cln.quick_note 'vim ctags: shows the list',                        ':tselect or :ts'
  cln.quick_note 'vim ctags: goes to the next tag in that list',     ':tnext   or :tn'
  cln.quick_note 'vim ctags: goes to the previous tag in that list', ':tprev   or :tp'
  cln.quick_note 'vim ctags: goes to the first tag of the list',     ':tfirst  or :tf'
  cln.quick_note 'vim ctags: goes to the last tag of the list',      ':tlast   or :tl'
  cln.quick_note 'to most recent change',                            '`.', 'movement', 'navigation'
  cln.quick_note 'cycle through recent changes',                     'g;', 'movement', 'navigation'
  cln.quick_note 'Run a command at launch',                          'vim -c NERDTree'

  # emacs
    # FIXES
      cln.quick_note 'turn on region highlighting',          'M-x transient-mark-mode', 'emacs', 'fixes'
      cln.quick_note 'change major-mode to Ruby',            'M-x ruby-mode', 'emacs', 'fixes'
    # MINOR MODES
      cln.quick_note 'left screen follows right screen',     'M-x follow-mode', 'emacs', 'minor', 'modes'
    # BUILTINS
      cln.quick_note 'tutorial',                             'C-h t', 'emacs', 'builtins'
      cln.quick_note 'document key combo',                   'C-h k <key combo>', 'emacs', 'builtins'
      cln.quick_note 'document function',                    'C-h f', 'emacs', 'builtins'
      cln.quick_note 'document variable',                    'C-h v', 'emacs', 'builtins'
      cln.quick_note 'Apropos (document similar)',           'C-h a', 'emacs', 'builtins'
      cln.quick_note 'Man pages',                            'M-x man', 'emacs', 'builtins'
      cln.quick_note 'get rid of help-buffer & window',      'q', 'emacs', 'builtins'
      cln.quick_note 'get rid of help-buffer ~ window',      'C-x k', 'emacs', 'builtins'
      cln.quick_note 'start shell',                          'M-x eshell', 'emacs', 'builtins'
    # MOVEMENT
      cln.quick_note 'repeat',                               'C-u # command, eg: C-u 8 C-f', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'forward 1 sentence',                   'M-a', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'back one sentence',                    'M-e', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'beginning of line',                    'C-a', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'end of line',                          'C-e', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'back 1 word',                          'M-b', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'forward 1 word',                       'M-f', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'back 1 char',                          'C-b', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'forward 1 char',                       'C-f', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'down 1 line',                          'C-n', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'up 1 line',                            'C-p', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'down 1 screen',                        'M-v', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'up 1 screen',                          'C-v', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'beginning of doc',                     'M-<', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'end of doc',                           'M->', 'emacs', 'movement', 'moving', 'navigation'
      cln.quick_note 'realign cursor to middle of screen',   'C-l', 'emacs', 'movement', 'moving', 'navigation'
    # BUFFERS
      cln.quick_note 'list buffers',                         'C-x C-b', 'emacs', 'buffers'
      cln.quick_note 'visit buffer',                         'C-x b', 'emacs', 'buffers'
      cln.quick_note 'Cancel EVERYTHING!',                   'C-g', 'emacs', 'buffers', 'search'
      cln.quick_note 'last buffer',                          'C-x b return', 'emacs', 'buffers'
      cln.quick_note 'send buffer to end of list',           'C-y', 'emacs', 'buffers'
    # WINDOWS/FRAMES
      cln.quick_note 'Close current frame',                  'C-x 0', 'emacs', 'windows', 'frames'
      cln.quick_note 'Use only one frame',                   'C-x 1', 'emacs', 'windows', 'frames'
      cln.quick_note 'Split frame in half vertically',       'C-x 2', 'emacs', 'windows', 'frames'
      cln.quick_note 'Split frame in half horizontally',     'C-x 3', 'emacs', 'windows', 'frames'
      cln.quick_note 'Jump between frames',                  'C-x o', 'emacs', 'windows', 'frames'
    # SEARCH
      cln.quick_note 'Start a forward search',               'C-s', 'emacs', 'searching', 'searches'
      cln.quick_note 'Next item in forward search',          'C-s', 'emacs', 'searching', 'searches'
      cln.quick_note 'Start a backward search',              'C-r', 'emacs', 'searching', 'searches'
      cln.quick_note 'Next item in backward search',         'C-r', 'emacs', 'searching', 'searches'
      cln.quick_note 'Cancel search',                        'C-g', 'emacs', 'searching', 'searches'
      cln.quick_note 'Move to this search location',         'return', 'emacs', 'searching', 'searches'
      cln.quick_note 'Search through function definitions',  'C-x C-i', 'emacs', 'searching', 'searches'
    # FILES
      cln.quick_note 'open',                                 'C-x C-f', 'emacs', 'files'
      cln.quick_note 'revert to disk',                       'C-c r',   'emacs', 'files'
      cln.quick_note 'save the file',                        'C-x C-s', 'emacs', 'files'
    # EDITING
      cln.quick_note 'undo',                                 'C-_', 'emacs', 'editing'
      cln.quick_note 'delete char after cursor',             'C-d', 'emacs', 'editing'
      cln.quick_note 'kill word before cursor',              'M-<Delback>', 'emacs', 'editing'
      cln.quick_note 'kill word after the cursor',           'M-d', 'emacs', 'editing'
      cln.quick_note 'kill from cursor to end of line',      'C-k', 'emacs', 'editing'
      cln.quick_note 'kill to end of current sentence',      'M-k', 'emacs', 'editing'
      cln.quick_note 'set mark',                             'C-<space> since that is taken, use C-@', 'emacs', 'editing'
      cln.quick_note 'kill from mark to cursor',             'C-w', 'emacs', 'editing'
      cln.quick_note 'yank text back',                       'C-y', 'emacs', 'editing'
      cln.quick_note 'cycle through kill ring',              'M-y', 'emacs', 'editing'
      cln.quick_note 'evaluate lisp',                        'M-S-:', 'emacs', 'editing'

  # code examples
  cln.quick_note 'Floating point imprecision', 'ruby -e "p 7.01 - 7.00" # => 0.009999999999999787', 'arithmetic', 'math', 'code', 'examples'
  cln.quick_note 'Ripper', <<-RIPPER, 'ruby', 'parsing', 'parsers', 'lexing', 'lexers', 'code', 'examples'
    require 'ripper'

    class DemoBuilder < Ripper::SexpBuilder
      instance_methods.each do |meth_name|
        next unless meth_name =~ /^on_/
        super_meth = instance_method meth_name
        define_method meth_name do |*args|
          super_meth.bind(self).call(*args).tap do |result|
            puts "\#{meth_name}(\#{args.map(&:inspect).join(', ')})".ljust(30) << " #> \#{result.inspect}"
          end
        end
      end
    end

    src = %(1 # i am a comment)
    DemoBuilder.new(src).parse
    # >> on_int("1")                    #> [:@int, "1", [1, 0]]
    # >> on_sp(" ")                     #> [:@sp, " ", [1, 1]]
    # >> on_comment("# i am a comment") #> [:@comment, "# i am a comment", [1, 2]]
    # >> on_stmts_new()                 #> [:stmts_new]
    # >> on_stmts_add([:stmts_new], [:@int, "1", [1, 0]]) #> [:stmts_add, [:stmts_new], [:@int, "1", [1, 0]]]
    # >> on_program([:stmts_add, [:stmts_new], [:@int, "1", [1, 0]]]) #> [:program, [:stmts_add, [:stmts_new], [:@int, "1", [1, 0]]]]
  RIPPER

  # unix utils
    # grep
    cln.quick_note "show lines after when grepping",  "grep -A n pattern"
    cln.quick_note "show lines before when grepping", "grep -B n pattern"
    cln.quick_note "show lines around when grepping", "grep -C n pattern"

    # ln
    cln.quick_note "ln", "ln -s /existing/file /new/symbolic/link # relative links in /existing/file are not expanded >.<", 'soft links'

    # ssh and servers and shit
    cln.quick_note 'Moving public key to ssh server', 'ssh-copy-id # can be installed via homebrew', 'servers', 'remote'
    cln.quick_note 'who is logged in?',               'w', 'users', 'signed', 'names', 'servers', 'remote'
    cln.quick_note 'what server am I on?',            'hostname', 'servers', 'remote', 'computers'

    # less
    cln.quick_note 'less: go to next buffer', ':n'
    cln.quick_note 'less: go to previous buffer', ':p'

    # bash
    cln.quick_note 'check for interactive shell',                        'if [[ $- == *i* ]]; then echo yes; fi', 'bash', 'shells', 'logins'
    cln.quick_note 'replace with the nth argument of the previous line', '!!:n',                                  'bash', 'shells', 'logins'
    cln.quick_note 'last argument of previous line',                     '!$',                                    'bash', 'shells', 'logins'
    cln.quick_note 'all arguments of previous line',                     '!*',                                    'bash', 'shells', 'logins'

    # systemsetup
    cln.quick_note 'set system time',                   "systemsetup -setusingnetworktime off -setdate '04:20:2012'", 'clocks'
    cln.quick_note 'revert system time to actual time', "systemsetup -setusingnetworktime on", 'clocks'
end


exit ILikeMustaches::Console.new(cln).call
